name: Docker Build (Local)

on:
  workflow_dispatch:

jobs:
  docker-build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Docker Buildx
      uses: docker/setup-buildx-action@v3
    
    - name: Build Frontend Image
      uses: docker/build-push-action@v5
      with:
        context: .
        push: false
        tags: team-urlaubsplaner-frontend:latest
        cache-from: type=gha
        cache-to: type=gha,mode=max
    
    - name: Build Backend Image
      uses: docker/build-push-action@v5
      with:
        context: ./backend
        push: false
        tags: team-urlaubsplaner-backend:latest
        cache-from: type=gha
        cache-to: type=gha,mode=max
    
    - name: Test Docker Images
      run: |
        echo "ğŸ³ Testing Docker images..."
        docker run --rm team-urlaubsplaner-backend:latest node --version
        echo "âœ… Backend image test passed"
    
    - name: Create Deployment Instructions
      run: |
        echo "ğŸ³ Docker images built successfully!"
        echo "ğŸ“¦ Frontend: team-urlaubsplaner-frontend:latest"
        echo "ğŸ”§ Backend: team-urlaubsplaner-backend:latest"
        echo ""
        echo "ğŸš€ Local Deployment:"
        echo "   docker-compose -f docker-compose.production.yml up -d"
        echo ""
        echo "ğŸŒ Server Deployment:"
        echo "   1. Copy docker-compose.production.yml to server"
        echo "   2. Run: docker-compose -f docker-compose.production.yml up -d"
        echo ""
        echo "ğŸ“‹ Manual Docker Hub Push (if needed):"
        echo "   docker tag team-urlaubsplaner-frontend:latest your-username/team-urlaubsplaner-frontend:latest"
        echo "   docker tag team-urlaubsplaner-backend:latest your-username/team-urlaubsplaner-backend:latest"
        echo "   docker push your-username/team-urlaubsplaner-frontend:latest"
        echo "   docker push your-username/team-urlaubsplaner-backend:latest"
